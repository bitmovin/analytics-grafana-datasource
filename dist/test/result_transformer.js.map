{"version":3,"sources":["../../src/result_transformer.js"],"names":["transformDataToTable","rows","options","datapoints","_","map","row","timestamp","value","target","resultTarget","transformDataToTimeSeries","analyticsResult","groupBys","data","groupBy","results","interval","fromDate","Date","start","getTime","toDate","end","length","groupings","metricLabel","push","Object","keys","key","series","orderBy","paddedSeries","result","transform","response","config","resultFormat","ResultFormat","TABLE","TIME_SERIES"],"mappings":"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","sourcesContent":["import {ResultFormat} from './types/resultFormat';\nimport {padTimeSeriesAndSortByDate} from './utils';\n\nconst transformDataToTable = (rows, options) => {\n  let datapoints = _.map(rows, row => {\n    const timestamp = row[0];\n    const value = row[1];\n    return [value, timestamp];\n  });\n\n  return {\n    target: options.resultTarget,\n    datapoints: datapoints\n  }\n}\n\nconst transformDataToTimeSeries = (analyticsResult, options) => {\n  const groupBys = options.data.groupBy;\n  const results = [];\n\n  const interval = options.data.interval;\n  const fromDate = new Date(options.data.start).getTime();\n  const toDate = new Date(options.data.end).getTime();\n  if (groupBys.length > 0) {\n    let groupings = {};\n    _.map(analyticsResult.rows, row => {\n      const metricLabel = row[1];\n      if (!groupings[metricLabel]) {\n        groupings[metricLabel] = [];\n      }\n      const value = row[2];\n      const timestamp = row[0];\n      groupings[metricLabel].push([value, timestamp]);\n    });\n    for (let key of Object.keys(groupings)) {\n      const datapoints = groupings[key];\n      const series = {\n        target: key,\n        datapoints: _.orderBy(datapoints, [1], 'asc')\n      }\n      results.push(series);\n    }\n  } else {\n    const paddedSeries = padTimeSeriesAndSortByDate(analyticsResult.rows, fromDate, toDate, interval);\n    let result =  transformDataToTable(paddedSeries, options);\n    result.datapoints = _.orderBy(result.datapoints, [1], 'asc');\n    results.push(result);\n  }\n  return results;\n}\n\nexport const transform = (response, options) => {\n  const analyticsResult = response.data.data.result;\n  const config = response.config;\n  if (config.resultFormat === ResultFormat.TABLE) {\n    return [transformDataToTable(analyticsResult.rows, config)];\n  } else if (config.resultFormat === ResultFormat.TIME_SERIES) {\n    return transformDataToTimeSeries(analyticsResult, config);\n  }\n}\n"],"file":"result_transformer.js"}