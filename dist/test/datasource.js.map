{"version":3,"sources":["../../src/datasource.js"],"names":["getApiRequestUrl","baseUrl","isAdAnalytics","isMetric","BitmovinAnalyticsDatasource","instanceSettings","$q","backendSrv","templateSrv","type","url","jsonData","name","q","withCredentials","headers","apiKey","tenantOrgId","length","basicAuth","options","query","buildQueryParameters","targets","filter","t","hide","when","data","getAdhocFilters","adhocFilters","targetResponsePromises","_","map","target","resultFormat","ResultFormat","TIME_SERIES","interval","QUERY_INTERVAL","HOUR","filters","e","key","operator","value","replace","scopedVars","orderBy","order","licenseKey","license","start","range","from","toISOString","end","to","METRICS_ATTRIBUTE_LIST","includes","dimension","urlAppendix","metric","AGGREGATION","COUNT","ATTRIBUTE","LICENSE_KEY","percentileValue","intervalAutoLimit","AUTO","valueOf","intervalMs","intervalSnapTo","MONTH","startOf","DAY","MINUTE","groupBy","forEach","ORDERBY_ATTRIBUTES","INTERVAL","Number","limit","undefined","apiRequestUrl","doRequest","method","resultTarget","alias","refId","Promise","all","then","targetResponses","result","response","series","getLicenses","status","message","title","resolve","AD_ATTRIBUTE_LIST","ATTRIBUTE_LIST","datasourceRequest"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport { convertFilterValueToProperType, ATTRIBUTE, ATTRIBUTE_LIST, AD_ATTRIBUTE_LIST, METRICS_ATTRIBUTE_LIST, ORDERBY_ATTRIBUTES, getAsOptionsList } from './types/queryAttributes';\nimport { AGGREGATION } from './types/aggregations';\nimport { calculateAutoInterval, calculateAutoIntervalFromRange, QUERY_INTERVAL } from './types/intervals';\nimport { transform } from './result_transformer';\nimport { ResultFormat } from './types/resultFormat';\n\nconst getApiRequestUrl = (baseUrl, isAdAnalytics, isMetric) => {\n  if (isAdAnalytics === true) {\n    return baseUrl + '/analytics/ads/queries';\n  }\n  if (isMetric == true) {\n    return baseUrl + '/analytics/metrics';\n  }\n  return baseUrl + '/analytics/queries';\n};\n\nexport class BitmovinAnalyticsDatasource {\n\n  constructor(instanceSettings, $q, backendSrv, templateSrv) {\n    this.type = instanceSettings.type;\n    this.url = instanceSettings.url;\n    this.isAdAnalytics = instanceSettings.jsonData.isAdAnalytics;\n    this.name = instanceSettings.name;\n    this.q = $q;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n    this.withCredentials = instanceSettings.withCredentials;\n\n    this.headers = {\n      'Content-Type': 'application/json',\n      'X-Api-Key': instanceSettings.jsonData.apiKey,\n    };\n\n    const tenantOrgId = instanceSettings.jsonData.tenantOrgId;\n    if (typeof tenantOrgId === 'string' && tenantOrgId.length > 0) {\n      this.headers['X-Tenant-Org-Id'] = tenantOrgId;\n    }\n\n    if (typeof instanceSettings.basicAuth === 'string' && instanceSettings.basicAuth.length > 0) {\n      this.headers['Authorization'] = instanceSettings.basicAuth;\n    }\n  }\n\n  query(options) {\n    const query = this.buildQueryParameters(options);\n    query.targets = query.targets.filter(t => !t.hide);\n\n    if (query.targets.length <= 0) {\n      return this.q.when({ data: [] });\n    }\n\n    if (this.templateSrv.getAdhocFilters) {\n      query.adhocFilters = this.templateSrv.getAdhocFilters(this.name);\n    } else {\n      query.adhocFilters = [];\n    }\n\n    const targetResponsePromises = _.map(query.targets, target => {\n      target.resultFormat = target.resultFormat || ResultFormat.TIME_SERIES;\n      target.interval = target.interval || QUERY_INTERVAL.HOUR;\n\n      const filters = _.map([...target.filter, ...query.adhocFilters], e => {\n        let filter = {\n          name: (e.name) ? e.name : e.key,\n          operator: e.operator,\n          value: this.templateSrv.replace(e.value, options.scopedVars)\n        }\n        switch (filter.operator) {\n          case '=':\n            filter.operator = 'EQ';\n            break;\n          case '!=':\n            filter.operator = 'NE';\n            break;\n          case '<':\n            filter.operator = 'LT';\n            break;\n          case '>':\n            filter.operator = 'GT';\n            break;\n        }\n        return {\n          name: filter.name,\n          operator: filter.operator,\n          value: convertFilterValueToProperType(filter)\n        }\n      });\n      const orderBy = _.map(target.orderBy, e => ({ name: e.name, order: e.order }));\n      const data = {\n        licenseKey: target.license,\n        start: options.range.from.toISOString(),\n        end: options.range.to.toISOString(),\n        filters,\n        orderBy\n      };\n\n      let isMetric = METRICS_ATTRIBUTE_LIST.includes(target.dimension);\n      let urlAppendix = '';\n      \n      if (isMetric) {\n        urlAppendix = target.dimension;\n        data['metric'] = target.dimension\n      } else {\n        target.metric = target.metric || AGGREGATION.COUNT;\n        target.dimension = target.dimension || ATTRIBUTE.LICENSE_KEY;\n        urlAppendix = target.metric\n        data['dimension'] = target.dimension;\n    \n          if (target.metric === 'percentile') {\n            data['percentile'] = target.percentileValue;\n          }\n      }\n\n      if (target.resultFormat === ResultFormat.TIME_SERIES) {\n        if (target.intervalAutoLimit === true) {\n          data['interval'] = target.interval === QUERY_INTERVAL.AUTO ? calculateAutoIntervalFromRange(options.range.from.valueOf(), options.range.to.valueOf()) : target.interval;\n        }else{\n          data['interval'] = target.interval === QUERY_INTERVAL.AUTO ? calculateAutoInterval(options.intervalMs) : target.interval;\n        }\n        if (target.intervalSnapTo === true) {\n          switch (data['interval']) {\n            case QUERY_INTERVAL.MONTH:\n            data['start'] = options.range.from.startOf('month').toISOString();\n            data['end'] = options.range.to.startOf('month').toISOString();\n            break;\n            case QUERY_INTERVAL.DAY:\n            data['start'] = options.range.from.startOf('day').toISOString();\n            data['end'] = options.range.to.startOf('day').toISOString();\n            break;\n            case QUERY_INTERVAL.HOUR:\n            data['start'] = options.range.from.startOf('hour').toISOString();\n            data['end'] = options.range.to.startOf('hour').toISOString();\n            break;\n            case QUERY_INTERVAL.MINUTE:\n            data['start'] = options.range.from.startOf('minute').toISOString();\n            data['end'] = options.range.to.startOf('minute').toISOString();\n            break;\n          }\n        }\n      }\n      data['groupBy'] = target.groupBy;\n      data['orderBy'].forEach (e => {\n        if (e.name == ORDERBY_ATTRIBUTES.INTERVAL) {\n          e.name = data['interval'];\n        }\n      });\n      data['limit'] = Number(target.limit) || undefined;\n      var apiRequestUrl = getApiRequestUrl(this.url, this.isAdAnalytics, isMetric);\n\n      return this.doRequest({\n        url: apiRequestUrl + '/' + urlAppendix,\n        data: data,\n        method: 'POST',\n        resultTarget: target.alias || target.refId,\n        resultFormat: target.resultFormat\n      });\n    });\n\n    return Promise.all(targetResponsePromises).then(targetResponses => {\n      let result = [];\n      _.map(targetResponses, response => {\n        const series = transform(response, options);\n        result = [...result, ...series];\n      });\n      return {\n        data: result\n      };\n    });\n  }\n\n  testDatasource() {\n    return this.getLicenses().then(response => {\n      if (response.status === 200) {\n        return { status: \"success\", message: \"Data source is working\", title: \"Success\" };\n      }\n    });\n  }\n\n  annotationQuery(options) {\n\n  }\n\n  metricFindQuery(query) {\n\n  }\n\n  getTagKeys(options) {\n    if (this.isAdAnalytics)\n      return Promise.resolve(getAsOptionsList(AD_ATTRIBUTE_LIST));\n    return Promise.resolve(getAsOptionsList(ATTRIBUTE_LIST));\n  }\n\n  doRequest(options) {\n    options.withCredentials = this.withCredentials;\n    options.headers = this.headers;\n\n    return this.backendSrv.datasourceRequest(options);\n  }\n\n  buildQueryParameters(options) {\n    return options;\n  }\n\n  getLicenses() {\n    return this.doRequest({\n      url: this.url + '/analytics/licenses',\n      method: 'GET',\n    });\n  }\n}\n"],"file":"datasource.js"}