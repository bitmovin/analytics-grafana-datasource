define(["@grafana/data","@grafana/runtime","lodash","rxjs","moment","react","@grafana/ui"],((e,t,n,r,a,o,l)=>(()=>{"use strict";var i={781:t=>{t.exports=e},531:e=>{e.exports=t},7:e=>{e.exports=l},241:e=>{e.exports=n},468:e=>{e.exports=a},959:e=>{e.exports=o},269:e=>{e.exports=r}},s={};function c(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return i[e](n,n.exports,c),n.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{c.r(u),c.d(u,{plugin:()=>ie});var e=c(781),t=c(531),n=c(241),r=c(269);const a={license:"",orderBy:[],groupBy:[],filter:[],resultFormat:"time_series",interval:"AUTO"},o=[{value:"AUTO",label:"Auto"},{value:"MINUTE",label:"Minute"},{value:"HOUR",label:"Hour"},{value:"DAY",label:"Day"},{value:"MONTH",label:"Month"}],l=o[0],i=["MINUTE","HOUR","DAY","MONTH"],s=(e,t,n)=>{if("AUTO"!==e)return e;const r=n-t;return r<=108e5?"MINUTE":r<=5184e5?"HOUR":r<=2592e6?"DAY":"MONTH"},E=e=>{switch(e){case"MINUTE":return"minute";case"HOUR":return"hour";case"DAY":return"day";case"MONTH":return"month";default:return null}};var A=c(468),T=c.n(A);function _(e,t,n){const r=new Date(e),a=new Date(t);switch(n){case"MINUTE":return a.setSeconds(0,0);case"HOUR":return a.setMinutes(0,0,0);case"DAY":return a.setHours(r.getHours(),r.getMinutes(),0,0);case"MONTH":return 1===r.getDate()?a.setDate(r.getDate()):a.setDate(0),a.setHours(r.getHours(),r.getMinutes(),0,0)}}function O(e,t,r,a){if(0===e.length)return[];const o=E(a);if(null==o)throw new Error(`Query interval ${a} is not a valid interval.`);const l=[],i=e[0].length>2?[...e[0].slice(1,-1),0]:[0];let s=T()(t);for(;s.valueOf()<=r;){const e=[s.valueOf(),...i];l.push(e),s.add(1,o),"MONTH"===a&&1!==s.date()&&s.set("date",s.daysInMonth())}const c=(0,n.differenceWith)(l,e,((e,t)=>e[0]===t[0])),u=e.concat(c);return(0,n.sortBy)(u,(e=>e[0]))}const d=["AVG_CONCURRENTVIEWERS","MAX_CONCURRENTVIEWERS","AVG-DROPPED-FRAMES"],I=d.map((e=>({value:e,label:e}))),D=e=>d.includes(e),p=(e,t,r,a)=>{if((0,n.isEmpty)(e)&&(e=>{switch(e){case"CDN_PROVIDER":case"CUSTOM_DATA_1":case"CUSTOM_DATA_2":case"CUSTOM_DATA_3":case"CUSTOM_DATA_4":case"CUSTOM_DATA_5":case"CUSTOM_DATA_6":case"CUSTOM_DATA_7":case"CUSTOM_DATA_8":case"CUSTOM_DATA_9":case"CUSTOM_DATA_10":case"CUSTOM_DATA_11":case"CUSTOM_DATA_12":case"CUSTOM_DATA_13":case"CUSTOM_DATA_14":case"CUSTOM_DATA_15":case"CUSTOM_DATA_16":case"CUSTOM_DATA_17":case"CUSTOM_DATA_18":case"CUSTOM_DATA_19":case"CUSTOM_DATA_20":case"CUSTOM_DATA_21":case"CUSTOM_DATA_22":case"CUSTOM_DATA_23":case"CUSTOM_DATA_24":case"CUSTOM_DATA_25":case"CUSTOM_DATA_26":case"CUSTOM_DATA_27":case"CUSTOM_DATA_28":case"CUSTOM_DATA_29":case"CUSTOM_DATA_30":case"CUSTOM_USER_ID":case"ERROR_CODE":case"EXPERIMENT_NAME":case"ISP":case"PLAYER_TECH":case"PLAYER_VERSION":case"VIDEO_ID":return!0;default:return!1}})(t))return null;if("IN"===r)try{return(e=>{const t=JSON.parse(e);if(!Array.isArray(t))throw new Error;return t})(e)}catch(e){throw new Error('Couldn\'t parse IN filter, please provide data in JSON array form (e.g.: ["Firefox", "Chrome"]).')}return a?((e,t)=>{switch(t){case"IS_LINEAR":return"true"===e;case"AD_STARTUP_TIME":case"AD_WRAPPER_ADS_COUNT":case"AUDIO_BITRATE":case"CLICK_POSITION":case"CLOSE_POSITION":case"ERROR_CODE":case"MANIFEST_DOWNLOAD_TIME":case"MIN_SUGGESTED_DURATION":case"PAGE_LOAD_TIME":case"PLAYER_STARTUPTIME":case"SCREEN_HEIGHT":case"SCREEN_WIDTH":case"SKIP_POSITION":case"TIME_HOVERED":case"TIME_IN_VIEWPORT":case"TIME_PLAYED":case"TIME_UNTIL_HOVER":case"VIDEO_BITRATE":case"VIDEO_WINDOW_HEIGHT":case"VIDEO_WINDOW_WIDTH":{const t=parseInt(e,10);if(isNaN(t))throw new Error("Couldn't parse filter value, please provide data as an integer number");return t}case"CLICK_PERCENTAGE":case"CLOSE_PERCENTAGE":case"PERCENTAGE_IN_VIEWPORT":case"SKIP_PERCENTAGE":{const t=parseFloat(e);if(isNaN(t))throw new Error("Couldn't parse filter value, please provide data as a floating point number");return t}default:return e}})(e,t):((e,t)=>{switch(t){case"IS_CASTING":case"IS_LIVE":case"IS_MUTED":return"true"===e;case"AUDIO_BITRATE":case"BUFFERED":case"CLIENT_TIME":case"DOWNLOAD_SPEED":case"DRM_LOAD_TIME":case"DROPPED_FRAMES":case"DURATION":case"ERROR_CODE":case"PAGE_LOAD_TIME":case"PAGE_LOAD_TYPE":case"PAUSED":case"PLAYED":case"PLAYER_STARTUPTIME":case"SCREEN_HEIGHT":case"SCREEN_WIDTH":case"SEEKED":case"STARTUPTIME":case"VIDEO_BITRATE":case"VIDEO_DURATION":case"VIDEO_PLAYBACK_HEIGHT":case"VIDEO_PLAYBACK_WIDTH":case"VIDEO_STARTUPTIME":case"VIDEO_WINDOW_HEIGHT":case"VIDEO_WINDOW_WIDTH":case"VIDEOTIME_END":case"VIDEOTIME_START":case"VIEWTIME":{const t=parseInt(e,10);if(isNaN(t))throw new Error("Couldn't parse filter value, please provide data as an integer number");return t}case"ERROR_PERCENTAGE":case"REBUFFER_PERCENTAGE":{const t=parseFloat(e);if(isNaN(t))throw new Error("Couldn't parse filter value, please provide data as a floating point number");return t}default:return e}})(e,t)};function S(e,t,n,r,a,o,l){try{var i=e[o](l),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function C(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function l(e){S(o,r,a,l,i,"next",e)}function i(e){S(o,r,a,l,i,"throw",e)}l(void 0)}))}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class m extends e.DataSourceApi{getDefaultQuery(e){return a}query(t){var a=this;return C((function*(){const{range:o}=t,l=a.isRelativeRangeFrom(o.raw),c=t.targets=(0,n.filter)(t.targets,(e=>!e.hide)),u=(0,n.filter)(c,(e=>a.isQueryComplete(e))).map((A=C((function*(t){var c;const u="time_series"===t.resultFormat&&t.interval?s(t.interval,o.from.valueOf(),o.to.valueOf()):void 0;let A=o.from;const T=o.to;if(l){let e=s("AUTO",A.valueOf(),T.valueOf());null!=u&&(d=u,I=e,e=i.indexOf(d)<i.indexOf(I)?d:I);const t=E(e);null!=t&&(A=o.from.startOf(t))}var d,I;let S=t.metric;const C="percentile"===S?t.percentileValue:void 0;let R,m;t.dimension&&(D(t.dimension)?R=t.dimension:m=t.dimension);const y={filters:t.filter.map((e=>({name:e.name,operator:e.operator,value:p(e.value,e.name,e.operator,!!a.isAdAnalytics)}))),groupBy:t.groupBy,orderBy:t.orderBy,dimension:m,metric:R,start:A.toDate(),end:T.toDate(),licenseKey:t.license,interval:u,limit:a.parseLimit(t.limit),percentile:C},v=yield(0,r.lastValueFrom)(a.request(a.getRequestUrl(R,S),"POST",y)),f=v.data.data.result.rows,h=v.data.data.result.rowCount,M=v.data.data.result.columnLabels,g=[];y.interval&&(null===(c=y.groupBy)||void 0===c?void 0:c.length)>0?g.push(...function(t,r,a,o){if(0===t.length)return[];const l=[],i=new Map;t.forEach((e=>{var t;const n=e.slice(1,-1).toString();i.has(n)||i.set(n,[]),null===(t=i.get(n))||void 0===t||t.push(e)}));const s=[];i.forEach((e=>{s.push(O(e,_(e[0][0],r,o),a,o))}));const c=(0,n.zip)(...s[0])[0];return l.push({name:"Time",values:c,type:e.FieldType.time}),s.forEach((t=>{const r=t[0].slice(1,-1).join(", "),a=(0,n.zip)(...t).slice(-1);l.push({name:r,values:a[0],type:e.FieldType.number})})),l}(f,A.valueOf(),T.valueOf(),y.interval)):y.interval?g.push(...function(t,r,a,o,l){if(0===t.length)return[];const i=[],s=O(t,_(t[0][0],a,l),o,l),c=(0,n.zip)(...s);return i.push({name:"Time",values:c[0],type:e.FieldType.time}),i.push({name:r,values:c[c.length-1],type:e.FieldType.number}),i}(f,M.length>0?M[M.length-1].label:"Column 1",A.valueOf(),T.valueOf(),y.interval)):g.push(...function(t,r){if(0===t.length)return[];const a=[],o=(0,n.zip)(...t);let l=[];if(0===r.length)for(let e=0;e<o.length;e++)l.push(`Column ${e+1}`);else l.push(...r.map((e=>e.label)));return t[0].length>1&&o.slice(0,-1).forEach(((t,n)=>{a.push({name:l[n],values:t,type:e.FieldType.string})})),a.push({name:l[l.length-1],values:o[o.length-1],type:e.FieldType.number}),a}(f,M));let U=[];return h>=200&&(U=[{severity:"warning",text:"Your request reached the max row limit of the API. You might see incomplete data. This problem might be caused by the use of high cardinality columns in group by, too small interval, or too big of a time range."}]),(0,e.createDataFrame)({name:t.alias,fields:g,meta:{notices:U}})})),function(e){return A.apply(this,arguments)}));var A;return Promise.all(u).then((e=>({data:e})))}))()}isRelativeRangeFrom(e){return"string"==typeof e.from}parseLimit(e){if(null!=e)return Number.isInteger(e)?e:parseInt(e,10)}isQueryComplete(e){return!((0,n.isEmpty)(e.license)||(0,n.isEmpty)(e.dimension)||null!=e.dimension&&!D(e.dimension)&&(0,n.isEmpty)(e.metric))}getRequestUrl(e,t){let n="/analytics";return!0===this.isAdAnalytics&&(n+="/ads"),null!=e?n+"/metrics/"+e:n+"/queries/"+t}request(e,n,r){const a={"X-Api-Key":this.apiKey,"X-Api-Client":"analytics-grafana-datasource"};null!=this.tenantOrgId&&(a["X-Tenant-Org-Id"]=this.tenantOrgId);const o={url:this.baseUrl+e,headers:a,method:n,data:r};return(0,t.getBackendSrv)().fetch(o)}testDatasource(){var e=this;return C((function*(){return(0,r.lastValueFrom)(e.request("/analytics/licenses","GET").pipe((0,r.map)((()=>({status:"success",message:"Data source successfully setup and connected."}))),(0,r.catchError)((e=>{var t,n,a,o;let l="Bitmovin: ";e.status&&(l+=e.status+" "),e.statusText?l+=e.statusText:l+="Can not connect to Bitmovin API";let i,s=(null===(t=e.data)||void 0===t?void 0:t.message)||(null===(a=e.data)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.message);var c,u;return(null===(o=e.data)||void 0===o?void 0:o.requestId)&&(i="Timestamp: "+(new Date).toISOString(),i+=(null===(c=e.data)||void 0===c?void 0:c.requestId)?"\nRequestId: "+(null===(u=e.data)||void 0===u?void 0:u.requestId):""),(0,r.of)({status:"error",message:l,details:{message:s,verboseMessage:i}})}))))}))()}constructor(e){super(e),R(this,"baseUrl",void 0),R(this,"apiKey",void 0),R(this,"tenantOrgId",void 0),R(this,"isAdAnalytics",void 0),this.apiKey=e.jsonData.apiKey,this.tenantOrgId=e.jsonData.tenantOrgId,this.isAdAnalytics=e.jsonData.isAdAnalytics,this.baseUrl=e.url}}var y=c(959),v=c.n(y),f=c(7);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){h(e,t,n[t])}))}return e}function g(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function U(e,t,n,r,a,o,l){try{var i=e[o](l),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function N(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function l(e){U(o,r,a,l,i,"next",e)}function i(e){U(o,r,a,l,i,"throw",e)}l(void 0)}))}}const P=[{endpoint:"/analytics/licenses",mapperFunc:e=>({value:e.licenseKey,label:e.name?e.name:e.licenseKey})},{endpoint:"/analytics/virtual-licenses",mapperFunc:e=>({value:e.id,label:e.name?e.name:e.id})},{endpoint:"/analytics/demo-licenses",mapperFunc:e=>({value:e.id,label:e.name?e.name:e.id})}];function b(e,t,n,r){return L.apply(this,arguments)}function L(){return(L=N((function*(e,n,a,o){const l={"X-Api-Key":n,"X-Api-Client":"analytics-grafana-datasource"};null!=o&&(l["X-Tenant-Org-Id"]=o);const i={url:e,headers:l,method:"GET"},s=(yield(0,r.lastValueFrom)((0,t.getBackendSrv)().fetch(i))).data.data.result.items,c=[];for(const e of s)c.push(a(e));return c}))).apply(this,arguments)}function B(){return(B=N((function*(e,t,n){const r=[];for(const a of P){const o=yield b(t+a.endpoint,e,a.mapperFunc,n);r.push(...o)}return r}))).apply(this,arguments)}const V=["count","sum","avg","min","max","stddev","percentile","variance","median"].map((e=>({value:e,label:e}))),G=["ADVERTISER_NAME","AD_CLICKTHROUGH_URL","AD_DESCRIPTION","AD_DURATION","AD_FALLBACK_INDEX","AD_ID","AD_ID_PLAYER","AD_IMPRESSION_ID","AD_IS_PERSISTENT","AD_MODULE","AD_OFFSET","AD_PLAYBACK_HEIGHT","AD_PLAYBACK_WIDTH","AD_POSITION","AD_PRELOAD_OFFSET","AD_REPLACE_CONTENT_DURATION","AD_SCHEDULE_TIME","AD_SKIPPABLE","AD_SKIP_AFTER","AD_STARTUP_TIME","AD_SYSTEM","AD_TAG_PATH","AD_TAG_SERVER","AD_TAG_TYPE","AD_TAG_URL","AD_TITLE","AD_WRAPPER_ADS_COUNT","ANALYTICS_VERSION","APIORG_ID","APIUSER_ID","API_FRAMEWORK","AUDIO_BITRATE","AUTOPLAY","BROWSER","BROWSER_IS_BOT","BROWSER_VERSION_MAJOR","BROWSER_VERSION_MINOR","CDN_PROVIDER","CITY","CLICKED","CLICK_PERCENTAGE","CLICK_POSITION","CLICK_RATE","CLIENT_TIME","CLOSED","CLOSE_PERCENTAGE","CLOSE_POSITION","COMPLETED","COUNTRY","CREATIVE_AD_ID","CREATIVE_ID","CUSTOM_DATA_1","CUSTOM_DATA_10","CUSTOM_DATA_11","CUSTOM_DATA_12","CUSTOM_DATA_13","CUSTOM_DATA_14","CUSTOM_DATA_15","CUSTOM_DATA_16","CUSTOM_DATA_17","CUSTOM_DATA_18","CUSTOM_DATA_19","CUSTOM_DATA_2","CUSTOM_DATA_20","CUSTOM_DATA_21","CUSTOM_DATA_22","CUSTOM_DATA_23","CUSTOM_DATA_24","CUSTOM_DATA_25","CUSTOM_DATA_26","CUSTOM_DATA_27","CUSTOM_DATA_28","CUSTOM_DATA_29","CUSTOM_DATA_3","CUSTOM_DATA_30","CUSTOM_DATA_4","CUSTOM_DATA_5","CUSTOM_DATA_6","CUSTOM_DATA_7","CUSTOM_DATA_8","CUSTOM_DATA_9","CUSTOM_USER_ID","DAY","DAYPART","DEAL_ID","DEVICE_TYPE","DOMAIN","ERROR_CODE","ERROR_MESSAGE","EXPERIMENT_NAME","HOUR","IP_ADDRESS","ISP","IS_LINEAR","LANGUAGE","LICENSE_KEY","MANIFEST_DOWNLOAD_TIME","MEDIA_PATH","MEDIA_SERVER","MEDIA_URL","MIDPOINT","MINUTE","MIN_SUGGESTED_DURATION","MONTH","OPERATINGSYSTEM","OPERATINGSYSTEM_VERSION_MAJOR","OPERATINGSYSTEM_VERSION_MINOR","PAGE_LOAD_TIME","PAGE_LOAD_TYPE","PATH","PERCENTAGE_IN_VIEWPORT","PLATFORM","PLAYER","PLAYER_KEY","PLAYER_STARTUPTIME","PLAYER_TECH","PLAYER_VERSION","PLAY_PERCENTAGE","QUARTILE_1","QUARTILE_3","REGION","SCREEN_HEIGHT","SCREEN_WIDTH","SIZE","SKIPPED","SKIP_PERCENTAGE","SKIP_POSITION","STARTED","STREAM_FORMAT","SURVEY_URL","TIME","TIME_HOVERED","TIME_IN_VIEWPORT","TIME_PLAYED","TIME_TO_FIRST_AD","TIME_UNTIL_HOVER","UNIVERSAL_AD_ID_REGISTRY","UNIVERSAL_AD_ID_VALUE","USER_ID","VIDEO_BITRATE","VIDEO_ID","VIDEO_IMPRESSION_ID","VIDEO_TITLE","VIDEO_WINDOW_HEIGHT","VIDEO_WINDOW_WIDTH","YEAR"].map((e=>({value:e,label:e}))),w=["AD","ANALYTICS_VERSION","AUDIO_BITRATE","AUDIO_CODEC","AUDIO_LANGUAGE","AUTOPLAY","BROWSER","BROWSER_IS_BOT","BROWSER_VERSION_MAJOR","BROWSER_VERSION_MINOR","BUFFERED","CAST_TECH","CDN_PROVIDER","CITY","CLIENT_TIME","CONTEXT","COUNTRY","CUSTOM_DATA_1","CUSTOM_DATA_10","CUSTOM_DATA_11","CUSTOM_DATA_12","CUSTOM_DATA_13","CUSTOM_DATA_14","CUSTOM_DATA_15","CUSTOM_DATA_16","CUSTOM_DATA_17","CUSTOM_DATA_18","CUSTOM_DATA_19","CUSTOM_DATA_2","CUSTOM_DATA_20","CUSTOM_DATA_21","CUSTOM_DATA_22","CUSTOM_DATA_23","CUSTOM_DATA_24","CUSTOM_DATA_25","CUSTOM_DATA_26","CUSTOM_DATA_27","CUSTOM_DATA_28","CUSTOM_DATA_29","CUSTOM_DATA_3","CUSTOM_DATA_30","CUSTOM_DATA_4","CUSTOM_DATA_5","CUSTOM_DATA_6","CUSTOM_DATA_7","CUSTOM_DATA_8","CUSTOM_DATA_9","CUSTOM_USER_ID","DAY","DAYPART","DEVICE_CLASS","DEVICE_TYPE","DOMAIN","DOWNLOAD_SPEED","DRM_LOAD_TIME","DRM_TYPE","DROPPED_FRAMES","DURATION","ERROR_CODE","ERROR_MESSAGE","ERROR_PERCENTAGE","EXPERIMENT_NAME","FUNCTION","HOUR","ID","IMPRESSION_ID","INITIAL_TIME_TO_TARGET_LATENCY","IP_ADDRESS","ISP","IS_CASTING","IS_LIVE","IS_LOW_LATENCY","IS_MUTED","LANGUAGE","LATENCY","LICENSE_KEY","M3U8_URL","MINUTE","MONTH","MPD_URL","OPERATINGSYSTEM","OPERATINGSYSTEM_VERSION_MAJOR","OPERATINGSYSTEM_VERSION_MINOR","ORGANIZATION","PAGE_LOAD_TIME","PAGE_LOAD_TYPE","PATH","PAUSED","PLATFORM","PLAYED","PLAYER","PLAYER_STARTUPTIME","PLAYER_TECH","PLAYER_VERSION","PLAY_ATTEMPTS","PROG_URL","REBUFFER_PERCENTAGE","REGION","SCALE_FACTOR","SCREEN_HEIGHT","SCREEN_ORIENTATION","SCREEN_WIDTH","SEEKED","SIZE","STARTUPTIME","STATE","STREAM_FORMAT","SUBTITLE_ENABLED","SUBTITLE_LANGUAGE","SUPPORTED_VIDEO_CODECS","TARGET_LATENCY","TARGET_LATENCY_DELTA","TIME","TIME_TO_TARGET_LATENCY","USER_ID","VIDEOSTART_FAILED","VIDEOSTART_FAILED_REASON","VIDEOTIME_END","VIDEOTIME_START","VIDEO_BITRATE","VIDEO_CODEC","VIDEO_CODEC_TYPE","VIDEO_DURATION","VIDEO_ID","VIDEO_PLAYBACK_HEIGHT","VIDEO_PLAYBACK_WIDTH","VIDEO_SEGMENTS_DOWNLOADED","VIDEO_SEGMENTS_DOWNLOAD_SIZE","VIDEO_STARTUPTIME","VIDEO_TITLE","VIDEO_WINDOW_HEIGHT","VIDEO_WINDOW_WIDTH","VIEWTIME","YEAR"].map((e=>({value:e,label:e})));var F;function H(e){return v().createElement(f.HorizontalGroup,null,v().createElement(f.Select,{value:(0,n.isEmpty)(e.groupBy)?void 0:e.groupBy,onChange:t=>e.onChange(t.value),options:e.selectableGroupBys,width:30}),v().createElement(f.IconButton,{tooltip:"Move down",onClick:()=>e.onReorderGroupBy(1),name:"arrow-down",disabled:e.isLast}),v().createElement(f.IconButton,{tooltip:"Move up",onClick:()=>e.onReorderGroupBy(0),name:"arrow-up",disabled:e.isFirst}),v().createElement(f.IconButton,{tooltip:"Delete Group By",name:"trash-alt",onClick:e.onDelete,size:"lg",variant:"destructive"}))}!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(F||(F={}));const W=(e,t)=>t?(0,n.differenceWith)(G,e,((e,t)=>e.value===t)):(0,n.differenceWith)(w,e,((e,t)=>e.value===t));function Y(e){const t=0===e.groupBys.length?4:0;return v().createElement(f.VerticalGroup,null,e.groupBys.map(((t,n,r)=>{return v().createElement(H,{key:n,groupBy:(a=t,o=e.isAdAnalytics,o?G.filter((e=>e.value===a)):w.filter((e=>e.value===a))),onChange:t=>((t,n)=>{const r=[...e.groupBys];r.splice(t,1,n),e.onChange(r)})(n,t),selectableGroupBys:W(r,e.isAdAnalytics),onDelete:()=>(t=>{const n=[...e.groupBys];n.splice(t,1),e.onChange(n)})(n),isFirst:0===n,isLast:n===r.length-1,onReorderGroupBy:t=>((t,n)=>{const r=[...e.groupBys],a=r[n];r.splice(n,1);const o=t===F.UP?n-1:n+1;r.splice(o,0,a),e.onChange(r)})(t,n)});var a,o})),v().createElement("div",{style:{paddingTop:t}},v().createElement(f.IconButton,{name:"plus-square",tooltip:"Add Group By",onClick:()=>(()=>{const t=W(e.groupBys,e.isAdAnalytics)[0].value;e.onChange([...e.groupBys,t])})(),size:"xl"})))}const j=[{value:"ASC",description:"Sort by ascending",icon:"sort-amount-up"},{value:"DESC",description:"Sort by descending",icon:"sort-amount-down"}];function K(e){return v().createElement(f.HorizontalGroup,{spacing:"xs"},v().createElement(f.Select,{value:(0,n.isEmpty)(e.attribute)?void 0:e.attribute,onChange:t=>e.onAttributeChange(t),options:e.selectableOrderByAttributes,width:30}),v().createElement(f.RadioButtonGroup,{options:j,value:e.sortOrder,onChange:t=>e.onSortOrderChange(t)}),v().createElement(f.IconButton,{tooltip:"Move down",onClick:()=>e.onReorderOrderBy(F.DOWN),name:"arrow-down",disabled:e.isLast}),v().createElement(f.IconButton,{tooltip:"Move up",onClick:()=>e.onReorderOrderBy(F.UP),name:"arrow-up",disabled:e.isFirst}),v().createElement(f.IconButton,{tooltip:"Delete Order By",name:"trash-alt",onClick:e.onDelete,size:"lg",variant:"destructive"}))}const x=(e,t)=>t?(0,n.differenceWith)(G,e,((e,t)=>e.value===t.name)):(0,n.differenceWith)(w,e,((e,t)=>e.value===t.name));function k(e){const t=0===e.orderBys.length?4:0;return v().createElement(f.VerticalGroup,null,e.orderBys.map(((t,n,r)=>{return v().createElement(K,{key:n,isAdAnalytics:e.isAdAnalytics,selectableOrderByAttributes:x(r,e.isAdAnalytics),attribute:(a=t.name,o=e.isAdAnalytics,o?G.filter((e=>e.value===a)):w.filter((e=>e.value===a))),onAttributeChange:t=>((t,n)=>{const r=[...e.orderBys],a={name:n.value,order:r[t].order};r.splice(t,1,a),e.onChange(r)})(n,t),sortOrder:t.order,onSortOrderChange:t=>((t,n)=>{const r=[...e.orderBys],a={name:r[t].name,order:n};r.splice(t,1,a),e.onChange(r)})(n,t),onDelete:()=>(t=>{const n=[...e.orderBys];n.splice(t,1),e.onChange(n)})(n),isFirst:0===n,isLast:n===r.length-1,onReorderOrderBy:t=>((t,n)=>{const r=t===F.UP?n-1:n+1,a=[...e.orderBys],o=a[n];a.splice(n,1),a.splice(r,0,o),e.onChange(a)})(t,n)});var a,o})),v().createElement("div",{style:{paddingTop:t}},v().createElement(f.IconButton,{name:"plus-square",tooltip:"Add Order By",onClick:()=>(()=>{const t=x(e.orderBys,e.isAdAnalytics)[0].value;e.onChange([...e.orderBys,{name:t,order:"ASC"}])})(),size:"xl"})))}const Q=["GT","GTE","LT","LTE","EQ","NE","CONTAINS","NOTCONTAINS","IN"].map((e=>({value:e,label:e})));function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){q(e,t,n[t])}))}return e}function X(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function J(e){const t=null==e.value,[n,r]=(0,y.useState)(te(e.value));(0,y.useEffect)((()=>r(te(e.value))),[e.value]);const a=(0,y.useMemo)((()=>function(e,t){if(null!=e)return(t?G:w).find((t=>t.value===e))}(n.attribute,e.isAdAnalytics)),[n.attribute,e.isAdAnalytics]),o=(0,y.useMemo)((()=>function(e){if(null!=e)return Q.find((t=>t.value===e))}(n.operator)),[n.operator]);var l,i,s;return v().createElement(f.HorizontalGroup,{spacing:"xs"},v().createElement(f.Tooltip,{content:null!==(l=n.attributeError)&&void 0!==l?l:"",show:null!=n.attributeError,theme:"error"},v().createElement("div",null,v().createElement(f.Select,{value:a,onChange:function(e){r((t=>X(z({},t),{dirty:!0,attribute:e.value,attributeError:void 0})))},options:e.isAdAnalytics?G:w,width:Z,invalid:null!=n.attributeError}))),v().createElement(f.Tooltip,{content:null!==(i=n.operatorError)&&void 0!==i?i:"",show:null!=n.operatorError,theme:"error"},v().createElement("div",null,v().createElement(f.Select,{value:o,onChange:function(e){r((t=>X(z({},t),{dirty:!0,operator:e.value,operatorError:void 0})))},options:Q,width:$,invalid:null!=n.operatorError}))),v().createElement(f.Tooltip,{content:null!==(s=n.inputValueError)&&void 0!==s?s:"",show:null!=n.inputValueError,theme:"error"},v().createElement(f.Input,{value:n.value,onChange:e=>{return t=e.currentTarget.value,void r((e=>X(z({},e),{dirty:!0,value:t,inputValueError:void 0})));var t},invalid:null!=n.inputValueError,type:"text",width:ee})),v().createElement(f.IconButton,{variant:"destructive",name:"trash-alt",size:"lg",tooltip:"Delete Filter",onClick:e.onDelete}),(t||n.dirty)&&v().createElement(f.IconButton,{variant:"primary",name:t?"plus-square":"save",size:"lg",tooltip:t?"Add new filter":"Save changes",onClick:function(){if(null!=n.attribute)if(null!=n.operator)try{p(n.value,n.attribute,n.operator,e.isAdAnalytics),e.onChange({name:n.attribute,operator:n.operator,value:n.value})}catch(e){r((t=>X(z({},t),{inputValueError:e instanceof Error?e.message:"Could not save value"})))}else r((e=>X(z({},e),{operatorError:"Filter operator has to be selected"})));else r((e=>X(z({},e),{attributeError:"Filter attribute has to be selected"})))}}),!t&&n.dirty&&v().createElement(f.IconButton,{variant:"secondary",name:"history",size:"lg",tooltip:"Revert changes",onClick:function(){r(te(e.value))}}))}const Z=30,$=15,ee=30;function te(e){return{attribute:null==e?void 0:e.name,attributeError:void 0,operator:null==e?void 0:e.operator,operatorError:void 0,value:null==e?void 0:e.value,dirty:!1,inputValueError:void 0}}function ne(e){const[t,n]=(0,y.useState)(!1),r=0===e.filters.length?4:0;return v().createElement(f.VerticalGroup,null,(e.filters.length>0||t)&&v().createElement(f.HorizontalGroup,{spacing:"none"},v().createElement(f.InlineLabel,{width:Z,tooltip:""},"Attribute"),v().createElement(f.InlineLabel,{width:$,tooltip:""},"Operator"),v().createElement(f.InlineLabel,{width:ee,tooltip:""},"Value")),e.filters.map(((t,n)=>v().createElement(J,{isAdAnalytics:e.isAdAnalytics,value:t,onChange:t=>function(t,n){const r=[...e.filters];r.splice(t,1,n),e.onQueryFilterChange(r)}(n,t),onDelete:()=>function(t){const n=[...e.filters];n.splice(t,1),e.onQueryFilterChange(n)}(n),selectedQueryFilters:e.filters,key:n}))),v().createElement("div",{style:{paddingTop:r}},t?v().createElement(J,{isAdAnalytics:e.isAdAnalytics,value:void 0,onChange:function(t){const r=[...e.filters,t];e.onQueryFilterChange(r),n(!1)},onDelete:()=>n(!1),selectedQueryFilters:e.filters}):v().createElement(f.IconButton,{name:"plus-square",tooltip:"Add Filter",onClick:()=>n(!0),size:"xl"})))}function re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){re(e,t,n[t])}))}return e}function oe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var le;!function(e){e.Default="DEFAULT",e.Loading="LOADING",e.Success="SUCCESS",e.Error="ERROR"}(le||(le={}));const ie=new e.DataSourcePlugin(m).setConfigEditor((function(e){const{onOptionsChange:t,options:n}=e;(0,y.useEffect)((()=>{""!==n.url&&null!=n.url||t(g(M({},n),{url:"https://api.bitmovin.com/v1"}))}),[]);const{jsonData:r}=n;return v().createElement(v().Fragment,null,v().createElement(f.DataSourceHttpSettings,{defaultUrl:"https://api.bitmovin.com/v1",dataSourceConfig:n,onChange:t,showAccessOptions:!0}),v().createElement(f.FieldSet,{label:"Bitmovin Analytics Details"},v().createElement(f.InlineField,{required:!0,label:"API Key",labelWidth:26},v().createElement(f.Input,{required:!0,onChange:e=>{const r=g(M({},n.jsonData),{apiKey:e.currentTarget.value});t(g(M({},n),{jsonData:r}))},value:r.apiKey||"",placeholder:"Analytics API Key",width:40})),v().createElement(f.InlineField,{label:"Tenant Org Id",labelWidth:26},v().createElement(f.Input,{onChange:e=>{const r=g(M({},n.jsonData),{tenantOrgId:e.currentTarget.value});t(g(M({},n),{jsonData:r}))},value:r.tenantOrgId||"",placeholder:"Tenant Org Id",width:40})),v().createElement(f.InlineField,{label:"Ad Analytics",tooltip:"Check if you want to query ads data",labelWidth:26},v().createElement(f.InlineSwitch,{value:r.isAdAnalytics||!1,onChange:e=>{const r=g(M({},n.jsonData),{isAdAnalytics:e.currentTarget.checked});t(g(M({},n),{jsonData:r}))}}))))})).setQueryEditor((function(e){const t=(0,n.defaults)(e.query,a),[r,i]=(0,y.useState)([]),[s,c]=(0,y.useState)("DEFAULT"),[u,E]=(0,y.useState)(""),[A,T]=(0,y.useState)("time_series"===t.resultFormat),[_,O]=(0,y.useState)(t.percentileValue),d=(0,y.useMemo)((()=>!!t.dimension&&D(t.dimension)),[t.dimension]),p=(0,y.useMemo)((()=>"percentile"===t.metric),[t.metric]);return(0,y.useEffect)((()=>{c("LOADING"),function(e,t,n){return B.apply(this,arguments)}(e.datasource.apiKey,e.datasource.baseUrl,e.datasource.tenantOrgId).then((e=>{i(e),c("SUCCESS")})).catch((e=>{c("ERROR"),E(e.status+" "+e.statusText)}))}),[e.datasource.apiKey,e.datasource.baseUrl,e.datasource.tenantOrgId]),v().createElement("div",{className:"gf-form"},v().createElement(f.FieldSet,null,v().createElement(f.InlineField,{label:"License",labelWidth:20,invalid:"ERROR"===s,error:`Error when fetching Analytics Licenses: ${u}`,disabled:"ERROR"===s,required:!0},v().createElement(f.Select,{value:t.license,onChange:n=>{e.onChange(oe(ae({},t),{license:n.value})),e.onRunQuery()},width:30,options:r,noOptionsMessage:"No Analytics Licenses found",isLoading:"LOADING"===s,placeholder:"LOADING"===s?"Loading Licenses":"Choose License"})),v().createElement(f.HorizontalGroup,{spacing:"xs"},!d&&v().createElement(f.InlineField,{label:"Metric",labelWidth:20,required:!0},v().createElement(f.Select,{value:t.metric,onChange:n=>(n=>{e.onChange(oe(ae({},t),{metric:n.value})),e.onRunQuery()})(n),width:30,options:V})),p&&v().createElement(f.Input,{value:_,onChange:e=>{let t=parseInt(e.target.value,10);t<0?t=0:t>99&&(t=99),O(t)},onBlur:()=>{e.onChange(oe(ae({},t),{percentileValue:_})),e.onRunQuery()},type:"number",placeholder:"value",width:10})),v().createElement(f.InlineField,{label:"Dimension",labelWidth:20,required:!0},v().createElement(f.Select,{value:t.dimension,onChange:n=>{e.onChange(oe(ae({},t),{dimension:n.value})),e.onRunQuery()},width:30,options:e.datasource.isAdAnalytics?G:w.concat(I)})),v().createElement(f.InlineField,{label:"Filter",labelWidth:20},v().createElement(ne,{isAdAnalytics:!!e.datasource.isAdAnalytics,onQueryFilterChange:n=>{e.onChange(oe(ae({},t),{filter:n})),e.onRunQuery()},filters:t.filter})),v().createElement(f.InlineField,{label:"Group By",labelWidth:20},v().createElement(Y,{isAdAnalytics:!!e.datasource.isAdAnalytics,onChange:n=>{e.onChange(oe(ae({},t),{groupBy:n})),e.onRunQuery()},groupBys:t.groupBy})),v().createElement(f.InlineField,{label:"Order By",labelWidth:20},v().createElement(k,{isAdAnalytics:!!e.datasource.isAdAnalytics,onChange:n=>{e.onChange(oe(ae({},t),{orderBy:n})),e.onRunQuery()},orderBys:t.orderBy})),v().createElement(f.InlineField,{label:"Limit",labelWidth:20},v().createElement(f.Input,{defaultValue:t.limit,type:"number",onBlur:n=>{const r=parseInt(n.target.value,10);e.onChange(oe(ae({},t),{limit:isNaN(r)?void 0:r})),e.onRunQuery()},width:30,placeholder:"No limit"})),v().createElement(f.InlineField,{label:"Format as time series",labelWidth:20},v().createElement(f.InlineSwitch,{value:A,onChange:n=>{T(n.currentTarget.checked),n.currentTarget.checked?e.onChange(oe(ae({},t),{interval:"AUTO",resultFormat:"time_series"})):e.onChange(oe(ae({},t),{interval:void 0,resultFormat:"table"})),e.onRunQuery()}})),A&&v().createElement(v().Fragment,null,v().createElement(f.InlineField,{label:"Interval",labelWidth:20},v().createElement(f.Select,{defaultValue:l,value:t.interval,onChange:n=>(n=>{e.onChange(oe(ae({},t),{interval:n.value})),e.onRunQuery()})(n),width:30,options:o}))),v().createElement(f.InlineField,{label:"Alias By",labelWidth:20},v().createElement(f.Input,{defaultValue:t.alias,placeholder:"Naming pattern",onBlur:n=>{e.onChange(oe(ae({},t),{alias:n.target.value})),e.onRunQuery()}}))))}))})(),u})()));
//# sourceMappingURL=module.js.map